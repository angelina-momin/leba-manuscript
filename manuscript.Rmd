---
title             : "_Light Exposure Behavior Assessment (LEBA)_: Develop of a novel instrument to capture light exposure-related behaviours"
shorttitle        : "Title"

author: 
  - name          : "Mushfiqul Anwar Siraji"
    affiliation   : "1"
    corresponding : no   
    address       : "Monash University, Malaysia"
    email         : "mushfiqul.anwarsiraji@monash.edu"
    role:         
      - Data Analysis
      - Writing - Original Draft Preparation
      - Data Visualization
       
  - name          : "Rafael Robert Lazar"
    affiliation   : "2"
    role:
      - Data Analysis
      - Writing - Original Draft Preparation
      - Data Visualization
  - name          : "Manuel Spitschan "
    affiliation   : "3"
    corresponding : yes   
    address       : ""
    email         : ""
    role:         
      - Data Analysis
      - Writing - Original Draft Preparation
      - Data Visualization

  - name          : "Manuel Spitschan "
    affiliation   : "3"
    corresponding : yes   
    address       : ""
    email         : ""
    role:         
      - Data Analysis
      - Writing - Original Draft Preparation
      - Data Visualization

affiliation:
  - id            : "1"
    institution   : "Department of Psychology, Jeffrey Cheah School of Medicine and Health Sciences, Monash University, Malaysia"
  - id            : "2"
    institution   : "University of Basel"

authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  
  One or two sentences to put the results into a more **general context**.
  
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library(papaja) # devtools::install_github("crsh/papaja")
library(readr)
library(readxl)
library(lavaan)
library(semPlot)
library(semTools)
library(MOTE)
library(psych)
library(dlookr)
library(tidyverse)
library(qgraph)
library(kableExtra)
library(DiagrammeR) #devtools::install_github('rich-iannone/DiagrammeR')
library(DiagrammeRsvg)
library(rsvg)
r_refs("r-references.bib")
```


---
nocite: |
  `r cite_r("r-references.bib")`
---

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```
# Introduction

# Methods


## Participants

This line is just a test for pushing in the github repo.

## Material

```{r flowchart }
Flowchart1 <- grViz("digraph nicegraph{
         
                    graph [layout = dot,fontsize = 14]
                     
                     node[shape = rectangle, margin = 0.2, width = 6.5, height = 1, fixedsize = true]  
                     
                    A[label = '48 items were generataed by a robust expert panel'] 
                    B[label = 'Exploratory Factor Analysis on 48 Items (N = 428)']
                    
                    node[shape = rectangle, margin = 0.2, width = 6.5, height = 2, fixedsize = true]
                    C[label = 'Factor Identification
                    Scree Plot: 6 Factors
                    Parallel Analysis: 6 Factors
                    Minimum Average Partial Method: 5 Factors
                    Hull Method: 5 Factors']
                    
                     subgraph cluster_1 {
                      graph[shape = rectangle]
                      style = rounded
                     node[ margin = 0.2,width = 6.5, height = 1, fixedsize = true ]
                    
                     1[label = '5 Factor Solution Retained 23 Items']
                     2[label = 'Reliability Analysis on EFA Sample (N=428)
                    Alpha F1 =.49; F2 = .71; F3 = .86; F4 =.62; F5 =.77']
                    
                     3[label = 'Confirmatory Factor Analysis on Modified Model
                     on the Five Factor Model (21 Items; N=199)
                      Acceptable Fit ( CFI = .92; TLI .91; RMSEA = .05, SRMR = .07)']
                    
                     4[label = 'Reliability Analysis on CFA (N=199) 
                      Alpha F1=.47; F2=.67; F3 =.92; F4=.58; F5= .74']
                    }
                subgraph cluster_2 {
                      graph[shape = rectangle]
                      style = rounded
                     node[ margin = 0.2,width = 6.5, height = 1, fixedsize = true ]
                    5[label = '6-Factor  one factor with only two salient loadings']
                    6[label = 'Rejected']
                    }     
                     
                    
                     edge[color = black,arrowhead = vee, arrowsize = 1.25]
                     A ->B
                     B ->C
                     C ->1
                     1 ->2
                     2 ->3
                     3 ->4
                     C ->5
                     5 ->6
                     
                     
}")

export_svg(Flowchart1) %>%
  charToRaw() %>%
  rsvg() %>%
  png::writePNG("Flowchart1.png")

```



```{r, out.height= "50%",  fig.align='center', fig.cap='ABC'}
knitr::include_graphics('Flowchart1.png')
```

## Procedure
Our study had four objectives. First, to develop an instrument to assess individual's light exposure behavior . Second, to conduct an exploratory factor analysis(EFA)  to understand the latent structure. Third to gather structural validity evidence for the latent structure obtained in EFA.
[@furrPsychometricsIntroduction2014]. Lastly, we gathered item information using Item response theory (IRT)[@bakerBasicsItemResponse2017]


### Data Collection
Timeline of data collection, ethical approval, mode of data collection, how consent was recorded.

### Item generation and Content Validity: Expert Panel Review
How we developed the 48 items?

## Analytic Strategies

We used R (version 4.1.0), including several R-packages for our analyses. Necessary assumptions of EFA, including sample adequacy, normality assumptions, quality of correlation matrix were assessed. Our data violated both the univariate and multivariate normality assumptions. Due to these violations and the  ordinal nature of our response data we used polychoric correlation matrix [@desjardinsHandbookEducationalMeasurement2018] for the EFA. We employed principal axis (pa) a factor extraction method with varimax rotation. PA is apparently robust to the normality assumption violations [@watkinsStepbyStepGuideExploratory2020]. The obtained latent structure was confirmed by weighted least squares (WLS) extraction method as well. We used a combination factor indentification method including scree plot[@cattellScreeTestNumber1966], Horn's parallel analysis [@hornRationaleTestNumber1965], minimum average partials method[@velicerDeterminingNumberComponents1976], and hull method [@lorenzo-sevaHullMethodSelecting2011] to identify factor numbers.  Additionally, to identify the simple structure we followed the following guidelines recommended by psychometricians (i) no factors with fewer than three items (ii) no factors with a factor loading <0.3 (iii) no items with cross-loading greater than .3 across factors [@bandalosFactorAnalysisExploratory2018; @childEssentialsFactorAnalysis2006; @mulaikFoundationsFactorAnalysis2009; @watkinsStepbyStepGuideExploratory2020]

# Results
```{r Normality assumption EFA}
LB <- read_excel("recoded not reversed_EFA.xlsx")
LB$X1 <- NULL
#KMO test
KMO <- KMO(LB) 

# Test of correlation matrix
bartlet <- cortest.bartlett(LB, n =428)

# Univariante normality
normality <- normality(LB) 

# Multivariate Normality
mardia <- mardia(LB, na.rm = T, plot =F)

# Descriptives
Descriptives <- psych::describe(LB)
alpha <- psych::alpha(LB)
Item.total <- alpha$item.stats

Des.combined <- cbind(apa(Descriptives$mean,2,T), apa(Descriptives$sd,2,T), apa(Descriptives$skew,2,T),apa(Descriptives$kurtosis,2,T), apa(normality$statistic,2,T), apa(normality$p_value,2,F), apa(Item.total$r.cor,2,F))

colnames(Des.combined) = c("Mean", "SD", "Skew", "Kurtosis", "Shapiro-Wilk Statistics", "p", "Item-Total Correlation")

rownameprefix <- "Item"
rownamesufix <- seq(1:48)
my.names <- paste(rownameprefix,rownamesufix, sep = "" )

rownames(Des.combined) = (my.names)

#Polychoric Correlation matrix
LB.factor <- sapply(LB, as.factor)
correlations <- polychoric(LB.factor, correct = 0)
upper <- correlations$rho[upper.tri(correlations$rho, diag = F)]

as.data.frame(upper)
min.cor <- abs(min(upper)) #minimum cor.coefficient of the matrix
max.cor <- abs(max(upper)) # max. correlation coefficent of the matrix


# Calulating the percentange of correlations higher than .30

BigR = sum(correlations$rho >= abs(.30) & correlations$rho < abs(1.0), na.rm =T)/2 
totR = length(LB)*(length(LB)-1)/2
A <- print (BigR/totR)*100


# Item analysis
Item_analysis <- psych::alpha(LB)
Item_analysis$item.stats$r.cor
R.cor.sum <- summary(Item_analysis$item.stats$r.cor)
low.r.corec <- abs(R.cor.sum[1])  #minimum item total correlation
high.r.corec <- R.cor.sum[6]     # maximum item total correlation
```

Sampling adequacy was investigated by Kaiser-Meyer-Olkin (KMO) measures of sampling adequacy[@kaiserIndexFactorialSimplicity1974] . The overall KMO vale for 23 items was `r printnum(KMO$MSA)` which was above the cutoff value of .50 indicating a mediocre sample [@hutchesonMultivariateSocialScientist1999].


```{r tabDes, results='asis'}
apa_table(Des.combined, caption = "Descriptive Statistics")
```

```{r figCor,fig.cap= "Iter-correlation of the items",results='asis'}

qgraph(correlations$rho, cut =.30, details =T, posCol = "green", negCol = "orangered3", 
       labels = names(LB))
```


Table\@ref(tab:tabDes) summarizes the univariate descriptive statistics for the 48 items. some of the items were skewed with high Kurtosis values. The Shapiro-Wilk test of normality [@shapiroAnalysisVarianceTest1965] indicated all the items violated normality assumptions. Multivariate normality assumptions were investigated by Marida's test [@mardiaMeasuresMultivariateSkewness1970]. Multivariate skew = `r printnum(mardia$b1p)` (p <0.001) and multivariate kurtosis = `r printnum(mardia$b2p)` (p <0.001) indicated  multivariate normality assumptions violation. Due to these violations and ordinal nature of the response data  polychoric correlations over Pearson's correlations was chosen [@desjardinsHandbookEducationalMeasurement2018]. Bartlett's test of sphericity [@bartlettNoteMultiplyingFactors1954], $\chi^2$ (`r bartlet$df`) = `r apa(bartlet$chisq, 2, T)`, p < .001] indicated the correlations between items are adequate for the EFA. However only `r apa(((BigR/totR)*100), 2,T)`% of the inter-item correlation coefficients were greater than .30 in the obtained matrix. The inter item correlation ranged between `r apa(min.cor,2,F)` to `r apa(max.cor,2,F)`. The corrected item-total correlations ranged between `r apa(low.r.corec,2,F)` to `r apa(high.r.corec,2,F)`. 





# Confirmatory Factor Analysis


```{r CFA 23 items, include=FALSE}
LB.cfa <- read_excel("recoded not reversed_CFA.xlsx")
LB.model.Cor <- "F1 =~ item5 + item24 + item30 + item1 + item16 + item28
             F2 =~ item10 + item47 + item36 + item44 + item35 + item13
            F3 =~ item43 + item26 + item32
           F4 =~  item14 + item41+ item7 + item27 + item21
            F5 =~ item19 + item34 + item2" 



fit.Cor <- cfa(LB.model.Cor, data = LB.cfa, estimator = "MLR", mimic = "Mplus") 

## Summary of Model 
summary(fit.Cor, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)


## Selected Fit measures 
fit.1 <- fitmeasures (fit.Cor,c("gfi", "agfi", "nfi","rfi", 
                       "cfi.robust","tli.robust",
                       "rmsea.robust", 
                       "srmr","aic"))


semTools::reliability(fit.Cor)

```

```{r CFA23withMI, include=FALSE}
LB.model.Cor.3 <- "F1 =~ item5 + item24 + item30 + item1 + item16 + item28
             F2 =~ item10 + item47 + item36 + item44 + item35 + item13
            F3 =~ item43 + item26 + item32
           F4 =~  item14 + item41+ item7 + item27 + item21
            F5 =~ item19 + item34 + item2
item44 ~~ item13
item14 ~~  item7
item10 ~~ item13" 





## Fit the model 
fit.Cor.3 <- cfa(LB.model.Cor.3, data = LB.cfa, estimator = "MLR", mimic = "Mplus") 

reliability <- semTools::reliability(fit.Cor.3, return.total = T)
as.table(reliability)
## Summary of Model 
summary(fit.Cor.3, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)



## Selected Fit measures 
fit.3 <- fitmeasures (fit.Cor.3,c("gfi", "agfi", "nfi","rfi", 
                       "cfi.robust","tli.robust",
                       "rmsea.robust", 
                       "srmr","aic"))

rownames <-  ("fitIndices")
colnames <- c("gfi", "agfi", "nfi","rfi", 
                       "cfi.robust","tli.robust",
                       "rmsea.robust", 
                       "srmr","aic")


```

```{r CFI18items, include=FALSE}
LB.model.Cor.2 <- "F1 =~ item5 + item24 + item30 + item16 
             F2 =~ item10 + item47 + item36 + item44 + item35 
            F3 =~ item43 + item26 + item32
           F4 =~  item14 + item41+ item7 
            F5 =~ item19 + item34 + item2
item14 ~~  item7" 

#item 1 &28 discarded from F1;
#item13 discarded from F2
#item 27 & 21 discarded from F4

## Fit the model 
fit.Cor.2 <- cfa(LB.model.Cor.2, data = LB.cfa, estimator = "MLR", mimic = "Mplus") 

## Summary of Model 
summary(fit.Cor.2, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)


## Selected Fit measures 
fit.2 <- fitmeasures (fit.Cor.2,c("gfi", "agfi", "nfi","rfi", 
                       "cfi.robust","tli.robust",
                       "rmsea.robust", 
                       "srmr","aic"))

rownames <-  ("fitIndices")
colnames <- c("gfi", "agfi", "nfi","rfi", 
                       "cfi.robust","tli.robust",
                       "rmsea.robust", 
                       "srmr","aic")



```




# Discussion


\newpage
# References

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup
