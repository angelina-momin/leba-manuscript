---
title             : "The title"
shorttitle        : "Title"

author: 
  - name          : "First Author"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
    role:         # Contributorship roles (e.g., CRediT, https://casrai.org/credit/)
      - Conceptualization
      - Writing - Original Draft Preparation
      - Writing - Review & Editing
  - name          : "Ernst-August Doelle"
    affiliation   : "1,2"
    role:
      - Writing - Review & Editing

affiliation:
  - id            : "1"
    institution   : "Wilhelm-Wundt-University"
  - id            : "2"
    institution   : "Konstanz Business School"

authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  
  One or two sentences to put the results into a more **general context**.
  
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : 
  papaja::apa6_pdf:
    keep_tex: true
    latex_engine: xelatex
    includes:
      in_header: header.tex
    
mainfont: Arial
---
```{r setup, warning=FALSE, include=FALSE}
#This chunk controls the common chunk parameters for the whole manuscript
knitr::opts_chunk$set(echo = FALSE, warning = F, message = F, dpi=600, fig.width = 6,
 fig.asp = 0.8,out.width = "80%", dev=c('png','postscript'))
options(knitr.duplicate.label = "allow")
set.seed(123)
par(family = "Arial")

```

```{r library1, include=FALSE}

library(papaja) # devtools::install_github("crsh/papaja")
library(DiagrammeRsvg) #For DiagrammeR
library(rsvg) #For DiagrammeR
library(DiagrammeR) #devtools::install_github('rich-iannone/DiagrammeR')


r_refs("references.bib")
```



```{r Manuflowchart, eval=FALSE, include=FALSE}
Flowchart1 <- grViz("digraph my_flowchart{
         
                    graph [fontname = Helvetica,layout = dot,fontsize = 100,layout = dot ]
                     
                     node[fontname = Helvetica, shape = rectangle, margin = 0.2, width = 65, height = 10, 
                    fixedsize = true,fontsize = 200]  
                     
                    A[label = '48 items were generated'] 
                    B[label = 'Exploratory Factor Analysis on 48 Items (n = 428)']
                    
                    node[fontname = Helvetica, shape = rectangle, margin = 0.2, width = 65, height = 20, 
                    fixedsize = true, fontsize = 200]
                    C[label = 
                    <Factor Identification<br/>Scree Plot: 6 Factors<br/>Parallel Analysis: 6 Factors<br/>Minimum Average Partial Method: 5 Factors<br/>Hull Method: 5 Factors>
                    ]
                    
                     node[fontname = Helvetica, shape = rectangle, margin = 0.2, width = 80, height = 10, 
                    fixedsize = true,fontsize = 200]  
                     1[label = '5 Factor Solution Retained 25 Items']
                     2[label = <Reliability Analysis on EFA Sample (n=428)<br/>Ordinal alpha F1 =.94; F2 = .76; F3 = .75; F4 =.72; F5 =.62.>]
                    
                     3[label = <Confirmatory Factor Analysis<br/>on the Five Factor Model (25 Items; n=262)<br/>Acceptable Fit ( CFI = .94; TLI .93; RMSEA = .06, SRMR = .11)>]
                    
                    4[label = <Confirmatory Factor Analysis<br/>on the Five Factor Model (23 Items; n=262)<br/>Acceptable Fit ( CFI = .97; TLI= .96; RMSEA = .04, SRMR = .09)>]
                     5[label = <Reliability Analysis (23 Items; n=262)<br/>Ordinal alpha F1=.93; F2=.83; F3 =.70; F4=.69; F5=.52<br/>Mcdonald  omega(total) for the total scale = .73>]
                    8[label = <Measurement Invariance Analysis<br/>Residual measurement invariance achieved>]
                    9[label = 'Semantic Analysis']
                    10[label = <LEBA Short Form (18 Items; n=690)<br/>Based on Item Response Theory>]
              
              
                    6[label = 
                    <6-Factor solution:<br/>one factor emerged with only two salient loadings>
                    ]
                    7[label = 'Rejected']
                    
                     
                    
                     edge[fontname = Helvetica,color = black,arrowhead = vee, arrowsize = 5]
                     A ->B
                     B ->C
                     C ->1
                     1 ->2
                     2 ->3
                     3 ->4
                     4 ->5
                    5->8
                    8 ->9
                    9 ->10
                     C ->6
                     6 ->7
                     
                     
}"
)

export_svg(Flowchart1) %>%
  charToRaw() %>%
  rsvg() %>%
  png::writePNG("Manuscript.figures/Flowchart1.jpeg", dpi = 1200)


networkD3::saveNetwork(Flowchart1, "Manuscript.figures/flow.html")


webshot::webshot("Manuscript.figures/flow.html", "Manuscript.figures/flow1.png", vheight = 50, zoom = 8)

```

```{r IF, echo=FALSE, fig.align='center', fig.cap='Item information curve ', out.width='100%'}
knitr::include_graphics('Manuscript.figures/allitemplots.png', dpi = 300)
```

```{r library, include=FALSE}
#This chunk holds code for calling the required packages

library(papaja) # devtools::install_github("crsh/papaja")
library(lavaan)
library(semPlot) #devtools::install_github('SachaEpskamp/semPlot',  dependencies = T)
library(semTools)
library(MOTE)
library(car)#reversecoding 
library(psych)
library(dlookr)
library(plyr)
library(tidyverse)
library(qgraph)
library(kableExtra)
library(paran) # Parallel analysis
library(EFA.MRFA) # Hull method
library(DiagrammeR) #devtools::install_github('rich-iannone/DiagrammeR')
library(DiagrammeRsvg) #For DiagrammeR
library(rsvg) #For DiagrammeR
library(ggcorrplot)
library(semTable)
library(magick)
library(mirt)
library(gtsummary)
library(gt)
library(gtExtras)
library(likert)
library(VIM) #Missing data
library(kutils)
library(simsem)
library(tabledown)
library(readxl)
library(koRpus)# stable release
library(koRpus.lang.en)
library(reshape)
library(ggsci)
r_refs("references.bib")
```
```{r Data, include=FALSE}
#This chunk holds code for data wrangling

data <- readRDS("leba_2021-09-08.rds")

# Separating EFA and CFA samples with descriptive column
descriptives.data <- data

## Merge "0"s and "1"s into "1"s select,subset assign)
descriptives.data[ , 9:56 ][ descriptives.data[ , 9:56 ] == 0 ] <- 1
#EFA.descriptives <- descriptives.data[1:428,]
EFA.descriptives <- subset(descriptives.data, IncludedInEFA == "TRUE")
#CFA.descriptives <- descriptives.data[429:690, ]
CFA.descriptives<- subset(descriptives.data, IncludedInEFA == "FALSE")

#Separating the EFA and CFA(only items)
sem.data <- data[, 9:56] #EFA & CFA data
sem.data[ sem.data == 0] <- 1 #Merged "0"s and "1"s into "1"s

## renaming the column-header
prefix <- "item"
sufix <- c(1:48)
colnam <- paste(prefix,sufix, sep = "" )
colnames(sem.data) <- colnam
names(sem.data)[names(sem.data) == "item1"] <- "item01"
names(sem.data)[names(sem.data) == "item2"] <- "item02"
names(sem.data)[names(sem.data) == "item3"] <- "item03"
names(sem.data)[names(sem.data) == "item4"] <- "item04"
names(sem.data)[names(sem.data) == "item5"] <- "item05"
names(sem.data)[names(sem.data) == "item6"] <- "item06"
names(sem.data)[names(sem.data) == "item7"] <- "item07"
names(sem.data)[names(sem.data) == "item8"] <- "item08"
names(sem.data)[names(sem.data) == "item9"] <- "item09"
```

```{r prepareDescTable, include=FALSE}
#This chunk holds code for demographic data wrangling.

listdescVars <- colnames(descriptives.data[c(1:3,5:7)])


#seperating naming and  reducing data for descriptive Table 
desctable.data <- dplyr::select(descriptives.data, c(listdescVars,
                          IncludedInCFA))

#renaming TRUE and FALSE from the IncludedInCFA to EFA and CFA for Descriptive Table
desctable.data$IncludedInCFA[desctable.data$IncludedInCFA == T ] <-
 "2. CFA Sample"
desctable.data$IncludedInCFA[desctable.data$IncludedInCFA == F ] <- 
 "1. EFA Sample"

# recode the Gender factor so it will only show "Gender Diverse" in the summary table
desctable.data$slypos_demographics_gender.factor <-
  recode_factor(desctable.data$slypos_demographics_gender.factor, "No" = "Yes",
         "Yes"= "No")
       
# create descriptive table for the demographic vars (excluding tz & Country) with gtsummary
desctable.data %>%
  tbl_summary(
    by = IncludedInCFA,
    statistic = list(all_continuous() ~ "{mean} ({sd})",
                     all_categorical() ~ "{n} ({p}%)"),
    digits = all_continuous() ~ 2,
    label = list(slypos_demographics_age ~ "Age",
                 slypos_demographics_sex.factor ~ "Sex",
                 slypos_demographics_gender.factor ~ "Gender-Variant Identity",
                 slypos_demographics_language.factor ~ "Native English Speaker",
                 slypos_demographics_work_or_school.factor ~ "Occupational Status",
                 slypos_demographics_school.factor ~ "Occupational setting"
                 ),
    missing = "no"
    ) %>% add_overall() %>% bold_labels() %>% add_p() %>% add_q() %>%
modify_header(label ~ "**Variable**") %>% separate_p_footnotes() %>%
  modify_caption("Demographic Characteristics") -> desc_table 

as_tibble(desc_table) -> desc_tibble 
as_kable_extra(desc_table, format = "latex",booktabs = T) -> desc_kable #save it as a knitr::kable

#summarise country/time zone data

descriptives.data%>%
  tbl_summary(
    label = slypos_demographics_tz.factor ~ "Time zone - Country",
    statistic = list(all_categorical() ~ "{n} ({p}%)"),
    missing = "no",
    sort = all_categorical() ~ "frequency",
    include = "slypos_demographics_tz.factor"
  )  %>% bold_labels() %>% 
  modify_header(label ~ "") %>%
  as_tibble(format = 'pipe') -> tz_tibble

```

Table \@ref(tab:tabtabtab) 

```{r tabtabtab, warning=F, message=F}
desc_kable  %>% kable_styling(latex_options = c("scale_down")) %>% landscape()
```

Table \@ref(tab:tabtabtab) 

\newpage

# References

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup
